<div class="admin-dashboard-container">
  <h1 class="admin-dashboard-title">Media Management</h1>
  <%- include('../partials/messages') %>

  <!-- Backup/Restore Controls -->
  <div class="card shadow mb-4">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">ğŸ§  Media Storage Management</h6>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-4 mb-3">
          <form action="/admin/media/backup" method="POST" class="d-inline">
            <button type="submit" class="btn btn-primary btn-block">
              <i class="fas fa-database"></i> ğŸ§© Create Backup Now
            </button>
          </form>
        </div>
        <div class="col-md-4 mb-3">
          <form action="/admin/media/restore" method="POST" class="d-inline">
            <button type="submit" class="btn btn-success btn-block">
              <i class="fas fa-sync"></i> ğŸ” Restore Media
            </button>
          </form>
        </div>
        <div class="col-md-4 mb-3">
          <form action="/admin/media/auto-restore/toggle" method="POST" class="d-inline">
            <button type="submit" class="btn btn-info btn-block">
              <i class="fas fa-cog"></i> ğŸ§  Auto Restore On Startup
            </button>
          </form>
        </div>
      </div>
      <% if (lastBackup) { %>
        <div class="alert alert-info mt-3">
          <small>Last backup: <%= new Date(lastBackup.backupDate).toLocaleString() %> | Files: <%= lastBackup.backupItems.length %></small>
        </div>
      <% } %>
    </div>
  </div>

  <!-- Media Display Panel -->
  <div class="card shadow mb-4">
    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
      <h6 class="m-0 font-weight-bold text-primary">Media Display Panel</h6>
      <div>
        <a href="/admin/media/sync-logs" class="btn btn-outline-secondary btn-sm mr-2">
          <i class="fas fa-history"></i> View Sync Logs
        </a>
        <form action="/admin/media/backup" method="POST" class="d-inline mr-2">
          <button type="submit" class="btn btn-primary btn-sm">Create Media Backup</button>
        </form>
        <form action="/admin/media/delete-all" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete ALL media files? This action cannot be undone.');">
          <button type="submit" class="btn btn-danger btn-sm">
            <i class="fas fa-trash"></i> Delete All Media
          </button>
        </form>
      </div>
    </div>
    <div class="card-body">
      <div class="row">
        <% if (media && media.length > 0) { %>
          <% media.forEach(item => { %>
            <div class="col-md-4 mb-4">
              <div class="card">
                <% if (item.fileType && item.fileType.startsWith('image/')) { %>
                  <img src="<%= item.filePath %>" class="card-img-top" alt="<%= item.fileName %>" loading="lazy">
                <% } else if (item.fileType && item.fileType.startsWith('video/')) { %>
                  <video controls class="card-img-top" loading="lazy">
                    <source src="<%= item.filePath %>" type="<%= item.fileType %>">
                    Your browser does not support the video tag.
                  </video>
                <% } %>
                <div class="card-body">
                  <h5 class="card-title"><%= item.fileName %></h5>
                  <p class="card-text"><%= item.description %></p>
                  <p class="card-text"><small class="text-muted">Uploaded on: <%= new Date(item.uploadDate).toLocaleDateString() %></small></p>
                  <form action="/admin/media/<%= item._id %>?_method=DELETE" method="POST" class="d-inline">
                    <button type="submit" class="btn btn-danger btn-sm"><i class="fas fa-trash"></i> Delete</button>
                  </form>
                </div>
              </div>
            </div>
          <% }); %>
        <% } else { %>
          <p>No media uploaded yet.</p>
        <% } %>
      </div>
    </div>
  </div>

  <!-- Pagination controls -->
  <nav aria-label="Page navigation example" class="mt-4">
    <ul class="pagination justify-content-center">
      <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
        <a class="page-link" href="/admin/media?page=<%= currentPage - 1 %>&limit=<%= limit %>" tabindex="-1" aria-disabled="<%= currentPage === 1 ? 'true' : 'false' %>">Previous</a>
      </li>
      <% for (let i = 1; i <= totalPages; i++) { %>
        <li class="page-item <%= i === currentPage ? 'active' : '' %>"><a class="page-link" href="/admin/media?page=<%= i %>&limit=<%= limit %>"><%= i %></a></li>
      <% } %>
      <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
        <a class="page-link" href="/admin/media?page=<%= currentPage + 1 %>&limit=<%= limit %>">Next</a>
      </li>
    </ul>
  </nav>
</div>